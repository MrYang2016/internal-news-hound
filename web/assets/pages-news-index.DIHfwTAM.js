import{_ as t,o as e,c as i,w as s,a,b as n,t as o,i as l,d as r,g as d,e as c,f as h,n as u,h as p,j as m,k as g,l as b,r as f,s as w,m as y,p as T,F as _,S as L,q as A,u as I,v as k,x}from"./index-RIw19vfp.js";function S(t){var e=Date.now(),i=Math.floor((e-t)/1e3),s=i<0;s&&(i=-i);var a=Math.floor(i/60),n=Math.floor(a/60),o=Math.floor(n/24),l=Math.floor(o/30),r=Math.floor(l/12),d="",c=0;r>0?(d="year",c=r):l>0?(d="month",c=l):o>0?(d="day",c=o):n>0?(d="hour",c=n):a>0?(d="minute",c=a):(d="second",c=0===i?i=1:i);var h={year:"%n% 年前",month:"%n% 月前",day:"%n% 天前",hour:"%n% 小时前",minute:"%n% 分钟前",second:"%n% 秒前"}[d].replace("%n%",c);return s?h.replace("前","后"):h}const v=t({props:{newsItem:{type:Object,default:function(t){return{}}}},methods:{click(){this.$emit("click")},close(t){t.stopPropagation(),this.$emit("close")}}},[["render",function(t,d,c,h,u,p){const m=l,g=r;return e(),i(g,{class:"media-item view",onClick:p.click},{default:s((()=>[a(g,{class:"view"},{default:s((()=>[a(m,{class:"media-title"},{default:s((()=>[n(o(c.newsItem.title),1)])),_:1})])),_:1}),a(g,{class:"view"},{default:s((()=>[a(m,{class:"summary"},{default:s((()=>[n(o(c.newsItem.summary),1)])),_:1})])),_:1}),a(g,{class:"media-foot flex-row"},{default:s((()=>[a(g,{class:"media-info flex-row"},{default:s((()=>[a(m,{class:"info-text"},{default:s((()=>[n(o(c.newsItem.source),1)])),_:1}),a(m,{class:"info-text"},{default:s((()=>[n(o(c.newsItem.datetime),1)])),_:1})])),_:1})])),_:1}),a(g,{class:"media-item-line",style:{position:"absolute"}})])),_:1},8,["onClick"])}],["__scopeId","data-v-e3aeebab"]]),C=d().platform,D={name:"UniLoadMore",props:{status:{type:String,default:"more"},showIcon:{type:Boolean,default:!0},iconType:{type:String,default:"auto"},color:{type:String,default:"#777777"},contentText:{type:Object,default:()=>({contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"没有更多数据了"})}},data:()=>({platform:C}),methods:{onClick(){this.$emit("clickLoadMore",{detail:{status:this.status}})}}};const M=t({components:{newsPage:t({components:{uniLoadMore:t(D,[["render",function(t,d,m,g,b,f){const w=r,y=l;return e(),i(w,{class:"uni-load-more",onClick:f.onClick},{default:s((()=>[("circle"===m.iconType||"auto"===m.iconType&&"android"===b.platform)&&"loading"===m.status&&m.showIcon?(e(),c("svg",{key:0,width:"24",height:"24",viewBox:"25 25 50 50",class:"uni-load-more__img uni-load-more__img--android-H5"},[h("circle",{cx:"50",cy:"50",r:"20",fill:"none",style:u({color:m.color}),"stroke-width":"3"},null,4)])):"loading"===m.status&&m.showIcon?(e(),i(w,{key:1,class:"uni-load-more__img uni-load-more__img--ios-H5"},{default:s((()=>[a(w,{style:u({backgroundColor:m.color})},null,8,["style"]),a(w,{style:u({backgroundColor:m.color})},null,8,["style"]),a(w,{style:u({backgroundColor:m.color})},null,8,["style"]),a(w,{style:u({backgroundColor:m.color})},null,8,["style"]),a(w,{style:u({backgroundColor:m.color})},null,8,["style"]),a(w,{style:u({backgroundColor:m.color})},null,8,["style"]),a(w,{style:u({backgroundColor:m.color})},null,8,["style"]),a(w,{style:u({backgroundColor:m.color})},null,8,["style"]),a(w,{style:u({backgroundColor:m.color})},null,8,["style"]),a(w,{style:u({backgroundColor:m.color})},null,8,["style"]),a(w,{style:u({backgroundColor:m.color})},null,8,["style"]),a(w,{style:u({backgroundColor:m.color})},null,8,["style"])])),_:1})):p("",!0),a(y,{class:"uni-load-more__text",style:u({color:m.color})},{default:s((()=>[n(o("more"===m.status?m.contentText.contentdown:"loading"===m.status?m.contentText.contentrefresh:m.contentText.contentnomore),1)])),_:1},8,["style"])])),_:1},8,["onClick"])}],["__scopeId","data-v-5152d45b"]]),noData:t({name:"nodata",data:()=>({textTypes:{none:"暂无网络"},isConnected:!1,networkType:"none"}),mounted(){this.isIOS="ios"===d().platform,m((t=>{this.isConnected=t.isConnected,this.networkType=t.networkType})),g({success:t=>{this.networkType=t.networkType}})},methods:{retry(){this.$emit("retry")},async openSettings(){"none"!=this.networkType||this.openSystemSettings()},openAppSettings(){this.gotoAppSetting()},openSystemSettings(){this.isIOS?this.gotoiOSSetting():this.gotoAndroidSetting()},network(){var t=null,e=plus.ios.newObject("CTCellularData"),i=e.plusGetAttribute("restrictedState");return 0==i?(t=null,console.log("StateUnknown")):2==i?(t=1,console.log("已经开启了互联网权限:NotRestricted")):1==i&&(t=2,console.log("Restricted")),plus.ios.deleteObject(e),t},gotoAppSetting(){if(this.isIOS){var t=plus.ios.import("UIApplication").sharedApplication(),e=plus.ios.import("NSURL"),i=e.URLWithString("app-settings:");t.openURL(i),plus.ios.deleteObject(i),plus.ios.deleteObject(e),plus.ios.deleteObject(t)}else{var s=plus.android.importClass("android.content.Intent"),a=plus.android.importClass("android.provider.Settings"),n=plus.android.importClass("android.net.Uri"),o=plus.android.runtimeMainActivity(),l=new s;l.setAction(a.ACTION_APPLICATION_DETAILS_SETTINGS);var r=n.fromParts("package",o.getPackageName(),null);l.setData(r),o.startActivity(l)}},gotoiOSSetting(){var t=plus.ios.import("UIApplication").sharedApplication(),e=plus.ios.import("NSURL"),i=e.URLWithString("App-prefs:root=General");t.openURL(i),plus.ios.deleteObject(i),plus.ios.deleteObject(e),plus.ios.deleteObject(t)},gotoAndroidSetting(){var t=plus.android.importClass("android.content.Intent"),e=plus.android.importClass("android.provider.Settings"),i=plus.android.runtimeMainActivity(),s=new t(e.ACTION_SETTINGS);i.startActivity(s)}}},[["render",function(t,d,c,h,u,m){const g=l,b=r;return e(),i(b,{class:"nodata"},{default:s((()=>[a(b,{class:"nodata-content"},{default:s((()=>[a(b,{class:"text-view a-i-c j-c-c t-a-c"},{default:s((()=>[a(g,{class:"title"},{default:s((()=>[n(o(u.textTypes[u.networkType]),1)])),_:1})])),_:1}),a(b,{class:"icon-view"}),a(b,{class:"opera-view"},{default:s((()=>["none"!=u.networkType?(e(),i(b,{key:0,class:"btn btn-default",onClick:m.retry},{default:s((()=>[a(g,{class:"btn-text"},{default:s((()=>[n("重试")])),_:1})])),_:1},8,["onClick"])):p("",!0),"none"==u.networkType?(e(),i(b,{key:1,class:"btn btn-default",onClick:m.openSettings},{default:s((()=>[a(g,{class:"btn-text"},{default:s((()=>[n("设置")])),_:1})])),_:1},8,["onClick"])):p("",!0)])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-8d2c0cdd"]]),newsItem:v},props:{nid:{type:[Number,String],default:""},sourceName:{type:[String],default:""}},data:()=>({dataList:[],navigateFlag:!1,pulling:!1,refreshing:!1,refreshFlag:!1,refreshText:"",isLoading:!1,loadingText:"加载中...",isLastPage:!1,isNoData:!1,pulling:!1,angle:0,loadingMoreText:{contentdown:"",contentrefresh:"",contentnomore:""},refreshIcon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAB5QTFRFcHBw3Nzct7e39vb2ycnJioqK7e3tpqam29vb////D8oK7wAAAAp0Uk5T////////////ALLMLM8AAABxSURBVHja7JVBDoAgDASrjqj//7CJBi90iyYeOHTPMwmFZrHjYyyFYYUy1bwUZqtJIYVxhf1a6u0R7iUvWsCcrEtwJHp8MwMdvh2amHduiZD3rpWId9+BgPd7Cc2LIkPyqvlQvKxKBJ//Qwq/CacAAwDUv0a0YuKhzgAAAABJRU5ErkJggg=="}),created(){this.pullTimer=null,this.requestParams={size:10,page:1},this._isWidescreen=!1,b(this).observe({minWidth:768},(t=>{this._isWidescreen=t}))},methods:{loadData(t){this.isLoading||(this.isLoading=!0,this.isNoData=!1,f({url:"http://49.51.197.189:3004/crawler/news",data:{...this.requestParams,sourceName:this.sourceName},success:e=>{const i=e.data.news.map((t=>(console.log(S(new Date(t.time).getTime()),new Date(t.time).getTime(),t.time),{id:this.newGuid()+t.id,newsid:t.id,article_type:1,datetime:S(new Date(t.time).getTime()),title:t.title,image_url:"https://video-hls.kingswayvideo.com/101160411447946835957/0cb624e02a/1920_1080.mp4/thumb-1000-w1920.jpg",source:t.source.name,comment_count:0,post_id:t.id,link:t.link,summary:t.summary})));0!==i.length?(t?(this.dataList=i,this.requestParams.page=0):(this.dataList=this.dataList.concat(i),this.requestParams.page+=1),this.dataList.length>0&&this._isWidescreen&&this.dataList.length<=10&&this.goDetail(this.dataList[0])):this.isLastPage=!0},fail:t=>{0==this.dataList.length&&(this.isNoData=!0)},complete:e=>{this.isLoading=!1,t&&(this.refreshing=!1,this.refreshFlag=!1,this.refreshText="已刷新",this.pullTimer&&clearTimeout(this.pullTimer),this.pullTimer=setTimeout((()=>{this.pulling=!1}),1e3))}}))},loadMore(t){this.loadData()},clear(){this.dataList.length=0,this.requestParams.page=0},goDetail(t){location.href=t.link},closeItem(t){w({content:"不感兴趣？",success:e=>{e.confirm&&this.dataList.splice(t,1)}})},refreshData(){this.isLoading||(this.pulling=!0,this.refreshing=!0,this.refreshText="正在刷新...",this.loadData(!0))},onrefresh(t){this.refreshData()},onpullingdown(t){this.refreshing||(this.pulling=!1,Math.abs(t.pullingDistance)>Math.abs(t.viewHeight)?(this.refreshFlag=!0,this.refreshText="释放立即刷新"):(this.refreshFlag=!1,this.refreshText="下拉可以刷新"))},newGuid(){let t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return(t()+t()+"-"+t()+"-4"+t().substr(0,3)+"-"+t()+"-"+t()+t()+t()).toUpperCase()}}},[["render",function(t,d,h,u,m,g){const b=y("news-item"),f=r,w=l,A=L,I=y("no-data");return e(),i(f,{class:"page-news"},{default:s((()=>[a(A,{class:"listview",style:{flex:"1"},enableBackToTop:"true","scroll-y":"",onScrolltolower:d[0]||(d[0]=t=>g.loadMore())},{default:s((()=>[(e(!0),c(_,null,T(m.dataList,((t,n)=>(e(),i(f,{key:t.id},{default:s((()=>[a(b,{newsItem:t,onClose:t=>g.closeItem(n),onClick:e=>g.goDetail(t)},null,8,["newsItem","onClose","onClick"])])),_:2},1024)))),128)),m.isLastPage?p("",!0):(e(),i(f,{key:0,class:"loading-more"},{default:s((()=>[a(w,{class:"loading-more-text"},{default:s((()=>[n(o(m.loadingText),1)])),_:1})])),_:1}))])),_:1}),m.isNoData?(e(),i(I,{key:0,class:"no-data",onRetry:g.loadMore},null,8,["onRetry"])):p("",!0)])),_:1})}],["__scopeId","data-v-fee1b3f8"]])},data:()=>({tabList:[{id:"tab01",name:"all",newsid:0},{id:"tab02",name:"tol",newsid:1},{id:"tab03",name:"langleyadvancetimes local",newsid:2},{id:"tab04",name:"globalnews",newsid:3},{id:"tab05",name:"cbc",newsid:4},{id:"tab06",name:"langleyadvancetimes public",newsid:5},{id:"tab07",name:"langleycity events",newsid:6},{id:"tab08",name:"langleycity news",newsid:7}],tabIndex:0,cacheTab:[],scrollInto:"",navigateFlag:!1,indicatorLineLeft:0,indicatorLineWidth:0,isTap:!1}),onReady(){this._lastTabIndex=0,this.swiperWidth=0,this.tabbarWidth=0,this.tabListSize={},this._touchTabIndex=0,this.pageList=[];for(var t=0;t<this.tabList.length;t++){let e=this.$refs["page"+t];Array.isArray(e)?this.pageList.push(e[0]):this.pageList.push(e)}this.switchTab(this.tabIndex),this.selectorQuery()},methods:{ontabtap(t){let e=t.target.dataset.current||t.currentTarget.dataset.current;this.isTap=!0;var i=this.tabListSize[e];this.updateIndicator(i.left,i.width),this._touchTabIndex=e,this.switchTab(e)},onswiperchange(t){},onswiperscroll(t){if(!this.isTap){var e=t.detail.dx,i=this._lastTabIndex;if(e>1?i++:e<-1&&i--,!(i===this._lastTabIndex||i<0||i>this.pageList.length-1)){0===this.pageList[i].dataList.length&&this.loadTabData(i);var s=Math.abs(this.swiperWidth/e),a=this.tabListSize[this._lastTabIndex],n=this.tabListSize[i],o=a.left+(n.left-a.left)/s,l=a.width+(n.width-a.width)/s;this.updateIndicator(o,l)}}},animationfinish(t){let e=t.detail.current;this._touchTabIndex===e&&(this.isTap=!1),this._lastTabIndex=e,this.switchTab(e),this.updateIndicator(this.tabListSize[e].left,this.tabListSize[e].width)},selectorQuery(){A().in(this).select(".tab-box").fields({dataset:!0,size:!0},(t=>{this.swiperWidth=t.width})).exec(),A().in(this).selectAll(".uni-tab-item").boundingClientRect((t=>{t.forEach((t=>{this.tabListSize[t.dataset.id]=t})),this.updateIndicator(this.tabListSize[this.tabIndex].left,this.tabListSize[this.tabIndex].width)})).exec()},getElementSize(t,e,i){t.getComponentRect(e,(t=>{this.tabListSize[i]=t.size}))},updateIndicator(t,e){this.indicatorLineLeft=t,this.indicatorLineWidth=e},switchTab(t){if(0===this.pageList[t].dataList.length&&this.loadTabData(t),this.tabIndex!==t){if(this.pageList[this.tabIndex].dataList.length>100){this.cacheTab.indexOf(this.tabIndex)<0&&this.cacheTab.push(this.tabIndex)}if(this.tabIndex=t,this.scrollInto=this.tabList[t].id,this.cacheTab.length>3){let t=this.cacheTab[0];this.clearTabData(t),this.cacheTab.splice(0,1)}}},scrollTabTo(t){const e=this.$refs["tabitem"+t][0];let i=0;t>0&&(i=this.tabbarWidth/2-this.tabListSize[t].width/2,this.tabListSize[t].right<this.tabbarWidth/2&&(i=this.tabListSize[0].width)),dom.scrollToElement(e,{offset:-i})},loadTabData(t){this.pageList[t].loadData()},clearTabData(t){this.pageList[t].clear()}}},[["render",function(t,d,h,p,m,g){const b=l,f=r,w=L,A=y("newsPage"),S=x,v=k;return e(),i(f,{class:"tabs"},{default:s((()=>[a(w,{ref:"tabbar1",id:"tab-bar",class:"tab-bar",scroll:!1,"scroll-x":!0,"show-scrollbar":!1,"scroll-into-view":m.scrollInto},{default:s((()=>[a(f,{style:{"flex-direction":"column"}},{default:s((()=>[a(f,{style:{"flex-direction":"row"}},{default:s((()=>[(e(!0),c(_,null,T(m.tabList,((t,l)=>(e(),i(f,{class:"uni-tab-item",key:t.id,id:t.id,ref_for:!0,ref:"tabitem"+l,"data-id":l,"data-current":l,onClick:g.ontabtap},{default:s((()=>[a(b,{class:I(["uni-tab-item-title",m.tabIndex==l?"uni-tab-item-title-active":""])},{default:s((()=>[n(o(t.name),1)])),_:2},1032,["class"])])),_:2},1032,["id","data-id","data-current","onClick"])))),128))])),_:1}),a(f,{class:"scroll-view-indicator"},{default:s((()=>[a(f,{ref:"underline",class:I(["scroll-view-underline",m.isTap?"scroll-view-animation":""]),style:u({left:m.indicatorLineLeft+"px",width:m.indicatorLineWidth+"px"})},null,8,["class","style"])])),_:1})])),_:1})])),_:1},8,["scroll-into-view"]),a(f,{class:"tab-bar-line"}),a(v,{class:"tab-box",ref:"swiper1",current:m.tabIndex,duration:300,onChange:g.onswiperchange,onTransition:g.onswiperscroll,onAnimationfinish:g.animationfinish,onOnAnimationEnd:g.animationfinish},{default:s((()=>[(e(!0),c(_,null,T(m.tabList,((t,n)=>(e(),i(S,{class:"swiper-item",key:n},{default:s((()=>[a(A,{class:"page-item",nid:t.newsid,sourceName:t.name,ref_for:!0,ref:"page"+n},null,8,["nid","sourceName"])])),_:2},1024)))),128))])),_:1},8,["current","onChange","onTransition","onAnimationfinish","onOnAnimationEnd"])])),_:1})}],["__scopeId","data-v-3070667a"]]);export{M as default};
